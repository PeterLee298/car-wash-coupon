<view class="container">
  <view wx:if="{{!isLoggedIn}}" class="login-banner" bindtap="onGoLogin">
    <text class="login-text">登录后查看您的卡券</text>
    <text class="login-btn">立即登录</text>
  </view>

  <view class="function-entries" wx:if="{{functionEntries.length > 0}}">
    <swiper class="entry-swiper" indicator-dots="{{functionEntries.length > 8}}">
      <swiper-item wx:for="{{functionEntries}}" wx:for-index="idx" wx:for-item="entry" wx:key="id">
        <view class="entry-grid">
          <view class="entry-item" wx:for="{{entry}}" wx:key="id" bindtap="onFunctionEntryTap" data-link-url="{{item.linkUrl}}">
            <image class="entry-icon" src="{{item.iconUrl}}" mode="aspectFit"></image>
            <text class="entry-name">{{item.name}}</text>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>

  <view class="activity-section" wx:if="{{activities.length > 0}}">
    <swiper class="activity-swiper" indicator-dots autoplay circular>
      <swiper-item wx:for="{{activities}}" wx:key="id" bindtap="onActivityTap" data-link-url="{{item.linkUrl}}">
        <image class="activity-image" src="{{item.imageUrl}}" mode="aspectFill"></image>
      </swiper-item>
    </swiper>
  </view>

  <view class="store-section">
    <view class="section-header">
      <text class="section-title">附近好店</text>
      <text class="section-more" bindtap="onMoreStores">查看更多 ></text>
    </view>
    <view class="store-list">
      <view class="store-item card" wx:for="{{nearbyStores}}" wx:key="id" bindtap="onStoreTap" data-id="{{item.id}}">
        <view class="store-info">
          <text class="store-name">{{item.name}}</text>
          <text class="store-address">{{item.address}}</text>
          <text class="store-distance" wx:if="{{item.distance}}">距您{{item.distance}}km</text>
        </view>
        <view class="store-actions">
          <view class="action-btn" catchtap="onCallStore" data-phone="{{item.contactPhone}}">
            <image class="action-icon" src="/images/phone.png"></image>
          </view>
          <view class="action-btn" catchtap="onNavigateStore" data-latitude="{{item.latitude}}" data-longitude="{{item.longitude}}" data-name="{{item.name}}">
            <image class="action-icon" src="/images/location.png"></image>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

<view class="agreement-modal" wx:if="{{showAgreement}}">
  <view class="modal-mask"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">用户协议</text>
    </view>
    <view class="modal-body">
      <text class="agreement-text">
        欢迎使用洗车券服务！在使用服务前，请您仔细阅读并同意
        <text class="agreement-link">《用户协议》</text>和
        <text class="agreement-link">《隐私政策》</text>。
      </text>
    </view>
    <view class="modal-footer">
      <view class="modal-btn cancel" bindtap="onCancelAgreement">取消</view>
      <view class="modal-btn confirm" bindtap="onAcceptAgreement">确认</view>
    </view>
  </view>
</view>
